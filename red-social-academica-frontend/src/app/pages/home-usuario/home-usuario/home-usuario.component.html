<div class="home-layout">
  <aside class="sidebar">
    <h3>Menú</h3>
    <p class="username">{{ usuario?.username }}</p>
    <p class="email">{{ usuario?.email }}</p>

    <nav class="menu">
      <button (click)="verSeccion('buscar')">🔍 Buscar</button>
      <button (click)="verSeccion('amigos')">👥 Amigos</button>
      <button (click)="verSeccion('publicaciones')">📝 Publicaciones</button>
      <button (click)="verSeccion('comentarios')">📤 Mis comentarios</button>
      <button (click)="verSeccion('invitaciones')">📨 Invitaciones</button>
      <button (click)="verSeccion('notificaciones')">🔔 Notificaciones</button>
    </nav>

    <hr />
    <button class="btn-rojo" (click)="darDeBaja()">Dar de baja</button>
    <button class="btn-negro" (click)="logout()">Cerrar sesión</button>
  </aside>

  <main class="contenido">
    <h2>Bienvenido, {{ usuario?.username }}</h2>

    <!-- Amigos -->
    <section *ngIf="seccion === 'amigos'">
      <h3>Amigos</h3>
      <ul>
        <li *ngFor="let amigo of amigos">
          {{ amigo.username }} ({{ amigo.email }})
        </li>
      </ul>
    </section>

    <!-- Buscar -->
    <section *ngIf="seccion === 'buscar'">
      <h3>Buscar usuario</h3>
      <input [(ngModel)]="busquedaUsername" placeholder="Username a buscar" />
      <button (click)="buscarUsuario()">Buscar</button>

      <div *ngIf="resultadoBusqueda">
        <p><strong>{{ resultadoBusqueda.username }}</strong> ({{ resultadoBusqueda.email }})</p>
        <button (click)="enviarInvitacion(resultadoBusqueda.username)">
          Enviar invitación
        </button>
      </div>

      <p *ngIf="busquedaFallida" class="error">Usuario no encontrado.</p>
    </section>

    <!-- Publicaciones -->
    <section *ngIf="seccion === 'publicaciones'">
      <h3>Publicaciones</h3>
      <p>(Aquí puedes mostrar publicaciones del usuario o generales)</p>
    </section>

    <!-- Mis comentarios -->
    <section *ngIf="seccion === 'comentarios'">
      <h3>Mis comentarios</h3>

      <!-- Formulario nuevo comentario -->
      <div class="nuevo-comentario">
        <h4>Nuevo comentario</h4>
        <label>
          Post ID:
          <input type="number" [(ngModel)]="nuevoComentario.postId" />
        </label>
        <label>
          Contenido:
          <input type="text" [(ngModel)]="nuevoComentario.content" />
        </label>
        <button (click)="crearComentario()">Publicar</button>
      </div>

      <hr />

      <!-- Lista de comentarios -->
      <div *ngIf="comentariosPropios.length > 0; else sinComentarios">
        <ul>
          <li *ngFor="let c of comentariosPropios">
            <div *ngIf="comentarioEditando?.id !== c.id">
              <p><strong>Post #{{ c.postId }}</strong>: {{ c.content }}</p>
              <button (click)="editarComentario(c)">Editar</button>
              <button (click)="eliminarComentario(c.id)">Eliminar</button>
            </div>

            <!-- Edición -->
            <div *ngIf="comentarioEditando?.id === c.id">
              <input [(ngModel)]="comentarioEditando.content" />
              <button (click)="guardarEdicionComentario()">Guardar</button>
              <button (click)="cancelarEdicion()">Cancelar</button>
            </div>
          </li>
        </ul>
      </div>
      <ng-template #sinComentarios>
        <p>No has publicado comentarios aún.</p>
      </ng-template>

      <hr />

      <!-- Ver comentarios de un post -->
      <div class="ver-post-comentarios">
        <h4>Ver comentarios de un post</h4>
        <label>
          Post ID:
          <input type="number" [(ngModel)]="postIdParaVerComentarios" />
        </label>
        <button (click)="verComentariosDePost()">Buscar</button>

        <div *ngIf="comentariosDePost.length > 0">
          <ul>
            <li *ngFor="let c of comentariosDePost">
              <p><strong>{{ c.authorFullName }}</strong>: {{ c.content }}</p>
            </li>
          </ul>
        </div>
      </div>
    </section>



    <!-- Invitaciones -->
    <section *ngIf="seccion === 'invitaciones'">
      <h3>Invitaciones pendientes</h3>
      <ul *ngIf="invitaciones.length > 0; else sinInv">
        <li *ngFor="let inv of invitaciones">
          <strong>{{ inv.senderName || inv.senderUsername }}</strong> te ha enviado una invitación.
          <button (click)="aceptarInvitacion(inv.id)">Aceptar</button>
          <button (click)="rechazarInvitacion(inv.id)">Rechazar</button>
        </li>
      </ul>
      <ng-template #sinInv>
        <p>No tienes invitaciones pendientes.</p>
      </ng-template>
    </section>

    <!-- Notificaciones -->
    <section *ngIf="seccion === 'notificaciones'">
      <h3>Notificaciones</h3>
      <p>(Aquí puedes mostrar notificaciones futuras)</p>
    </section>
  </main>
</div>
