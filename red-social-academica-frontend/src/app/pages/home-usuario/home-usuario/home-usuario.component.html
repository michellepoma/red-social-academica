<div *ngIf="usuario; else cargando">
  <div class="container mt-5">
    <h2>Bienvenido, {{ usuario.username }}</h2>
    <p><strong>Email:</strong> {{ usuario.email }}</p>
    <p><strong>Estado:</strong> {{ usuario.estado }}</p>
    <p><strong>Roles:</strong> {{ usuario.roles?.join(', ') }}</p>

    <button class="btn btn-outline-danger" (click)="darDeBaja()">Dar de baja mi cuenta</button>
    <button class="btn btn-secondary ms-2" (click)="logout()">Cerrar Sesión</button>

    <hr />
    <h4>Amigos</h4>
    <ul *ngIf="amigos.length > 0; else sinAmigos">
      <li *ngFor="let amigo of amigos">
        {{ amigo.username }} ({{ amigo.email }})
      </li>
    </ul>
    <ng-template #sinAmigos>
      <p>No tienes amigos registrados aún.</p>
    </ng-template>

    <hr />
    <h4>Buscar usuario</h4>
    <input
      type="text"
      [(ngModel)]="busquedaUsername"
      class="form-control w-50 d-inline"
      placeholder="Username a buscar"
    />
    <button class="btn btn-primary ms-2" (click)="buscarUsuario()">Buscar</button>

    <div *ngIf="resultadoBusqueda" class="mt-3">
      <p><strong>Usuario:</strong> {{ resultadoBusqueda.username }}</p>
      <p><strong>Email:</strong> {{ resultadoBusqueda.email }}</p>
      <button class="btn btn-success btn-sm"
              (click)="enviarInvitacion(resultadoBusqueda.username)">
        Enviar invitación
      </button>
    </div>


    <div *ngIf="busquedaFallida && !resultadoBusqueda" class="mt-3 text-danger">
      No se encontró el usuario buscado.
    </div>
  </div>
</div>

<ng-template #cargando>
  <p class="text-center mt-5">Cargando datos del usuario...</p>
</ng-template>

<hr />
<h4>Invitaciones pendientes</h4>

<ul *ngIf="invitaciones.length > 0; else sinInvitaciones">
  <li *ngFor="let invitacion of invitaciones">
    <strong>{{ invitacion.senderUsername }}</strong>
    <button class="btn btn-success btn-sm ms-2"
            (click)="aceptarInvitacion(invitacion.id)">
      Aceptar
    </button>
  </li>
</ul>

<ng-template #sinInvitaciones>
  <p>No tienes invitaciones pendientes.</p>
</ng-template>
